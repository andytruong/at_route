<?php

class At_Route_TestCase extends DrupalWebTestCase {
  public function getInfo() {
    return array(
      'name' => 'AT Route',
      'description' => 'Make sure the at_route is working correctly.',
      'group' => 'AT Route',
    );
  }

  public function setUp() {
    parent::setUp('atest_route');
  }

  public function testConfigGet() {
    # Test /atest_route/drupal
    $output = menu_execute_active_handler('atest_route/drupal', FALSE);
    $this->assertEqual('Hello Andy Truong', $output);

    # Test /atest_route/controller
    $output = menu_execute_active_handler('atest_route/controller', FALSE);
    $this->assertEqual('Hi Andy Truong!', $output);

    # Test /atest_route/template
    $output = menu_execute_active_handler('atest_route/template', FALSE);
    $output = trim(render($output));
    $this->assertEqual('Hello Andy Truong', $output);

    # Test /atest_route/fancy_template/%user
    $_GET['q'] = 'atest_route/fancy_template/1';
    $output = menu_execute_active_handler('atest_route/fancy_template/1', FALSE);
    $output = render($output);
    $this->assertTrue(strpos($output, 'Foo: bar'));
    $this->assertTrue(strpos($output, 'User ID: 1'));
  }
}
